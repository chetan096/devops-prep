pipeline {
   agent any
   tools{
      maven 'Maven3'
	    jdk 'Java'
   }
   stages {
     stage('Checkout'){
	     steps {
	      checkout scm
	     } 
     }
	 stage('Junits'){
	   steps {
	     echo 'Run unit test cases'
		 bat 'mvn -f nagp-assignment-devops/pom.xml test'
	   }
	 }
	 stage('Sonar Analysis'){
	    steps {
		   withSonarQubeEnv('Test_Sonar') {
                  bat 'mvn -f nagp-assignment-devops/pom.xml sonar:sonar'
                }
		}
	 }
	 stage('Build'){
	    steps {
		  bat 'mvn -f nagp-assignment-devops/pom.xml clean install'
		}
	 }
	 stage('Build Docker Image'){
	   bat 'docker build -t 3147181/nes-product:%BUILD_NUMBER% nagp-assignment-devops'
	 }
	 stage('Run Docker Container'){
	   bat 'docker run -d -p 8082:8081 --name nes-product 3147181/nes-product:%BUILD_NUMBER%'
	 }
   }
}